# stinger

Пинговалка адресов по заранее заданным конфигурациям.

# Для чего это?

Например вы хотите считать sla по проекту, но у вас недостаточно нагрузки.
Вы можете сказать сервису что пинговать и вуаля - у вас есть небольшая на сервис.
Или вам нужно постоянно что-то делать через какое-то апи и вы не хотите полагаться на крон.
Или ... ?

# Как добавить новый адрес для пингования

В директорию configs нужно добавить конфигурацию для вашего адреса через merge-request.
Конфигурацию сервис подхватит сразу после сборки.

Пример конфигурации:

```json
{
  "uri": "https://www.example.com",                                         # адрес куда стучимся
  "port": 443,                                                              # порт куда стучимся
  "name": "health",                                                         # имя правила
  "route": "/ping",                                                         # метод который дергаем на адресе
  "method": "POST",                                                         # тип метода
  "timeout": 5,                                                             # таймаут между запросами
  "headers": {"Content-Type": "application/json"},                          # хидеры запроса
  "payload": {"jsonrpc": "2.0", "method": "ping", "params": [], "id": 1}    # полезная нагрузка
}
}
```

json schema запроса конфигурации:

```json
{
    "type": "object",
    "properties": {
        "uri": {
            "type": "string",
            "format": "uri"
        },
        "port": {
            "type": "integer",
            "minimum": 0,
            "maximum": 65535,
        },
        "name": {
            "type": "string",
            "minLength": 2,
            "maxLength": 20
        },
        "route": {
            "type": "string",
            "pattern": "^\/[a-zA-Zа-яА-Я0-9 _\-\/]{1,}$"
        },
        "method": {
            "type": "string",
            "pattern": "^(GET|POST|PATCH|PUT|DELETE)$"
        },
        "timeout": {
            "type": "integer",
            "minimum": 2,
            "maximum": 600
        },
        "headers": {
            "type": "object"
        },
        "payload": {
            "type": "object"
        }
    },
    "required": [
        "uri",
        "port",
        "name",
        "route",
        "method",
        "timeout"
    ]
}
```

Дополнительная информация по именованию:

- Файлы именуйте в виде {имя-сервиса}-{название правила}-{дополнительная информация}.

Например myservice-myrule-post.

- Старайтесь именовать правило (директива {name}) в виде {имя-сервиса}-{название правила}. Иначе будут коллизии. 

Например myservice-myrule

- В идеале имя файла должно совпадать с директивой {name}.

# Операции над процессом пингования

Вы можете посмотреть статус процесса пингования вашего сервиса, используя метод апи:

```bash
/status
```

Также, если вдруг процесс мертв, вы можете сделать его рестарт, где {name} - имя вашего сервиса 
(см. конфигу директиву name):

```bash
/restart/{name}
```